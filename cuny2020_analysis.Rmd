---
title: "CUNY 2020 Analysis"
output: html_notebook
---

```{r}
library(tidyverse)
library(brms)
library(lme4)
library(lmerTest)
library(plotrix)
library(stringr)
library(readxl)
library(RColorBrewer)
library(Hmisc)
```

```{r}
lm_data = read.csv("coded_results.csv") %>%
  select(-X, x1, x2)
```

```{r}
brown = lm_data %>%
  filter(corpus == "bnc-brown")

brown_spr = read.csv("./corpora/brown_spr.csv") %>%
  group_by(code) %>%
    summarise(rt=mean(time)) %>%
  ungroup()

brown = merge(brown, brown_spr, by="code") %>%
  filter(surprisal > 0) %>%
  mutate(seed = as.factor(seed)) %>%
  mutate(surp_fac = cut_number(surprisal, n=10))
```


```{r}
brown %>%
  filter(model == "ordered-neurons") %>%
  group_by(training, surp_fac) %>%
    summarise(m=mean(rt),
              s=std.error(rt),
              upper=m+1.96*s,
              lower=m-1.96*s) %>%
    ungroup() %>%

  ggplot(aes(x=surp_fac, y=m, ymin=lower, ymax=upper, color=training)) +
    geom_errorbar(color="black", width=.2, position=position_dodge(width=.9), alpha=0.5) +
    geom_point(stat="identity", position="dodge", alpha=1, size=3) +
    ylab("Read Time") +
    xlab("Surprisal") +
    facet_wrap(~training) +
    #facet_grid(model~training) +
    theme(axis.text=element_text(size=10, angle=45, hjust=1))
ggsave("./images/brown-on.png",height=5,width=10)

```

```{r}
d_corr = brown %>%
  filter(model == "ordered-neurons", training == "bllip-xs") %>%
  select(surprisal, rt)
rcorr(as.matrix(d_corr))

d_corr = brown %>%
  filter(model == "ordered-neurons", training == "bllip-sm") %>%
  select(surprisal, rt)
rcorr(as.matrix(d_corr))

d_corr = brown %>%
  filter(model == "ordered-neurons", training == "bllip-md") %>%
  select(surprisal, rt)
rcorr(as.matrix(d_corr))

d_corr = brown %>%
  filter(model == "ordered-neurons", training == "bllip-lg") %>%
  select(surprisal, rt)
rcorr(as.matrix(d_corr))

```

```{r}
brown %>%
  filter(model == "rnng") %>%
  group_by(training, surp_fac) %>%
    summarise(m=mean(rt),
              s=std.error(rt),
              upper=m+1.96*s,
              lower=m-1.96*s) %>%
    ungroup() %>%

  ggplot(aes(x=surp_fac, y=m, ymin=lower, ymax=upper, color=training)) +
    geom_errorbar(color="black", width=.2, position=position_dodge(width=.9), alpha=0.5) +
    geom_point(stat="identity", position="dodge", alpha=1, size=3) +
    ylab("Read Time") +
    xlab("Surprisal") +
    facet_wrap(~training) +
    #facet_grid(model~training) +
    theme(axis.text=element_text(size=10, angle=45, hjust=1))
ggsave("./images/brown-rnng.png",height=5,width=10)

```

```{r}
d_corr = brown %>%
  filter(model == "rnng", training == "bllip-xs") %>%
  select(surprisal, rt)
rcorr(as.matrix(d_corr))

d_corr = brown %>%
  filter(model == "rnng", training == "bllip-sm") %>%
  select(surprisal, rt)
rcorr(as.matrix(d_corr))

d_corr = brown %>%
  filter(model == "rnng", training == "bllip-md") %>%
  select(surprisal, rt)
rcorr(as.matrix(d_corr))

d_corr = brown %>%
  filter(model == "rnng", training == "bllip-lg") %>%
  select(surprisal, rt)
rcorr(as.matrix(d_corr))

```


```{r}
brown %>%
  filter(model == "vanilla") %>%
  group_by(training, surp_fac) %>%
    summarise(m=mean(rt),
              s=std.error(rt),
              upper=m+1.96*s,
              lower=m-1.96*s) %>%
    ungroup() %>%

  ggplot(aes(x=surp_fac, y=m, ymin=lower, ymax=upper, color=training)) +
    geom_errorbar(color="black", width=.2, position=position_dodge(width=.9), alpha=0.5) +
    geom_point(stat="identity", position="dodge", alpha=1, size=3) +
    ylab("Read Time") +
    xlab("Surprisal") +
    facet_wrap(~training) +
    #facet_grid(model~training) +
    theme(axis.text=element_text(size=10, angle=45, hjust=1))
ggsave("./images/brown-vanilla.png",height=5,width=10)

```

```{r}
d_corr = brown %>%
  filter(model == "vanilla", training == "bllip-xs") %>%
  select(surprisal, rt)
rcorr(as.matrix(d_corr))

d_corr = brown %>%
  filter(model == "vanilla", training == "bllip-sm") %>%
  select(surprisal, rt)
rcorr(as.matrix(d_corr))

d_corr = brown %>%
  filter(model == "vanilla", training == "bllip-md") %>%
  select(surprisal, rt)
rcorr(as.matrix(d_corr))

d_corr = brown %>%
  filter(model == "vanilla", training == "bllip-lg") %>%
  select(surprisal, rt)
rcorr(as.matrix(d_corr))

```

```{r}

natural = lm_data %>%
  filter(corpus == "natural-stories")

natural_spr = read.csv("./corpora/natural_stories_rts.csv", sep="\t")%>%
  mutate(code = paste(zone, item, sep = "_")) %>%
  group_by(code) %>%
    summarise(rt=mean(RT)) %>%
  ungroup()

natural = merge(natural, natural_spr, by="code") %>%
  filter(surprisal > 0) %>%
  mutate(seed = as.factor(seed)) %>%
  mutate(surp_fac = cut_number(surprisal, n=10))

```

```{r}
natural %>%
  filter(model == "vanilla") %>%
  group_by(training, surp_fac) %>%
    summarise(m=mean(rt),
              s=std.error(rt),
              upper=m+1.96*s,
              lower=m-1.96*s) %>%
    ungroup() %>%

  ggplot(aes(x=surp_fac, y=m, ymin=lower, ymax=upper, color=training)) +
    geom_errorbar(color="black", width=.2, position=position_dodge(width=.9), alpha=0.5) +
    geom_point(stat="identity", position="dodge", alpha=1, size=3) +
    ylab("Read Time") +
    xlab("Surprisal") +
    facet_wrap(~training) +
    #facet_grid(model~training) +
    theme(axis.text=element_text(size=10, angle=45, hjust=1))
ggsave("./images/natural-vanilla.png",height=5,width=10)

```

```{r}
d_corr = natural %>%
  filter(model == "vanilla", training == "bllip-xs") %>%
  select(surprisal, rt)
rcorr(as.matrix(d_corr))

d_corr = natural %>%
  filter(model == "vanilla", training == "bllip-sm") %>%
  select(surprisal, rt)
rcorr(as.matrix(d_corr))

d_corr = natural %>%
  filter(model == "vanilla", training == "bllip-md") %>%
  select(surprisal, rt)
rcorr(as.matrix(d_corr))

d_corr = natural %>%
  filter(model == "vanilla", training == "bllip-lg") %>%
  select(surprisal, rt)
rcorr(as.matrix(d_corr))

```

```{r}
natural %>%
  filter(model == "ordered-neurons") %>%
  group_by(training, surp_fac) %>%
    summarise(m=mean(rt),
              s=std.error(rt),
              upper=m+1.96*s,
              lower=m-1.96*s) %>%
    ungroup() %>%

  ggplot(aes(x=surp_fac, y=m, ymin=lower, ymax=upper, color=training)) +
    geom_errorbar(color="black", width=.2, position=position_dodge(width=.9), alpha=0.5) +
    geom_point(stat="identity", position="dodge", alpha=1, size=3) +
    ylab("Read Time") +
    xlab("Surprisal") +
    facet_wrap(~training) +
    #facet_grid(model~training) +
    theme(axis.text=element_text(size=10, angle=45, hjust=1))
ggsave("./images/natural-on.png",height=5,width=10)

```
```{r}
d_corr = natural %>%
  filter(model == "ordered-neurons", training == "bllip-xs") %>%
  select(surprisal, rt)
rcorr(as.matrix(d_corr))

d_corr = natural %>%
  filter(model == "ordered-neurons", training == "bllip-sm") %>%
  select(surprisal, rt)
rcorr(as.matrix(d_corr))

d_corr = natural %>%
  filter(model == "ordered-neurons", training == "bllip-md") %>%
  select(surprisal, rt)
rcorr(as.matrix(d_corr))

d_corr = natural %>%
  filter(model == "ordered-neurons", training == "bllip-lg") %>%
  select(surprisal, rt)
rcorr(as.matrix(d_corr))

```


```{r}
natural %>%
  filter(model == "rnng") %>%
  group_by(training, surp_fac) %>%
    summarise(m=mean(rt),
              s=std.error(rt),
              upper=m+1.96*s,
              lower=m-1.96*s) %>%
    ungroup() %>%

  ggplot(aes(x=surp_fac, y=m, ymin=lower, ymax=upper, color=training)) +
    geom_errorbar(color="black", width=.2, position=position_dodge(width=.9), alpha=0.5) +
    geom_point(stat="identity", position="dodge", alpha=1, size=3) +
    ylab("Read Time") +
    xlab("Surprisal") +
    facet_wrap(~training) +
    #facet_grid(model~training) +
    theme(axis.text=element_text(size=10, angle=45, hjust=1))
ggsave("./images/natural-rnng.png",height=5,width=10)

```

```{r}
d_corr = natural %>%
  filter(model == "rnng", training == "bllip-xs") %>%
  select(surprisal, rt)
rcorr(as.matrix(d_corr))

d_corr = natural %>%
  filter(model == "rnng", training == "bllip-sm") %>%
  select(surprisal, rt)
rcorr(as.matrix(d_corr))

d_corr = natural %>%
  filter(model == "rnng", training == "bllip-md") %>%
  select(surprisal, rt)
rcorr(as.matrix(d_corr))

d_corr = natural %>%
  filter(model == "rnng", training == "bllip-lg") %>%
  select(surprisal, rt)
rcorr(as.matrix(d_corr))

```

